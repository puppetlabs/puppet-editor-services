name: "ci"

on:
  pull_request:
    branches:
      - "main"
  workflow_dispatch:

env:
  puppet_gem_version: '~> 8.0'
  ruby_version: '3.2'

jobs:
  spec:
    name: Spec
    runs-on: 'ubuntu-latest'
    steps:
    - name: "checkout"
      uses: "actions/checkout@v4"

    - name: "export environment"
      run: |
        echo "PUPPET_GEM_VERSION=${{ env.puppet_gem_version }}" >> $GITHUB_ENV

    - name: "setup ruby"
      uses: "ruby/setup-ruby@v1"
      with:
        ruby-version: ${{ env.ruby_version }}
        bundler-cache: true

    - name: "bundle environment"
      run: |
        echo ::group::bundler environment
        bundle env
        echo ::endgroup::
    
    - name: Start SSH session
      uses: luchihoratiu/debug-via-ssh@main
      with:
        NGROK_AUTH_TOKEN: ${{ secrets.NGROK_AUTH_TOKEN }}
        SSH_PASS: ${{ secrets.SSH_PASS }}